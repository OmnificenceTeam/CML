(window || this).bubbleText = function (a) { function g(a) { for (var c = [], d = 0, e = a.length; d < e; d++) { var f = a.charAt(d); f = " " === f ? "&nbsp;" : f, c[d] = { char: f, html: $('<span class="span-bubble-text">' + f + "</span>").appendTo(b) } } return c } if (a !== Object(a) || a.map === [].map) throw "bubbleText: Missing properties"; var b = $(a.element), c = b[0]; if (!c) throw "bubbleText: Missing element"; var d = b.find(":first").length; if (d) return; var e = a.newText; if ("string" != typeof e) throw "bubbleText: Missing newText"; var f = c.innerHTML; c.innerHTML = ""; for (var h = g(e), i = g(f), j = []; h.length;) { var k = h.shift(), l = { add: k, width: k.html.width() + "px" }; k.html.width(0); for (var m = k.char, n = 0, o = i.length; n < o; n++) if (m === i[n].char) { l.remove = i.splice(n, 1)[0]; break } j.push(l) } var p = 0; if (a.proportional) { var q = i.length, r = j.length; for (q > r ? (q = Math.ceil(q / r), r = 1) : (r = Math.ceil(r / q), q = 1) ; i.length;) if (p < j.length) { for (var s = i.splice(0, q) ; s.length;) j.splice(p, 0, { remove: s.shift() }), p++; p += r } else j.push({ remove: i.shift() }) } else for (; i.length;) { var l = { remove: i.shift() }; p < j.length ? (j.splice(p, 0, l), p += 2) : j.push(l) } var t = b.find("span"), u = $(t[0]).height(); t.each(function () { $(this).css({ position: "relative", display: "inline-block", height: u + "px", overflow: "hidden" }) }); var v = parseInt(a.letterSpeed) || Math.floor((a.speed || 2e3) / j.length), w = ["&nbsp;", ".", ","]; !function b(d) { var f = j[d]; if (!f) return c.innerHTML = e, void ("function" == typeof a.callback && a.callback()); var g = function () { b(d + 1) }, h = { duration: v, complete: g, easing: "linear" }; f.add && (h.complete = function () { var a = f.add.html.prev("span"); if (a.length) { var b = a.offset().top, c = f.add.html.offset().top; if (c !== b) { for (; w.indexOf(a.html()) === -1 && (a = a.prev("span"), 0 !== a.length) ;); a.after("<br>") } } g() }, f.add.html.animate({ width: f.width }, h)), f.remove && f.remove.html.animate({ width: 0 }, f.add ? { duration: v, easing: "linear" } : h) }(0) };